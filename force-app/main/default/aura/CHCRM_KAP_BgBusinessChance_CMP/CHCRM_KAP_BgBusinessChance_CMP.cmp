<aura:component implements="flexipage:availableForAllPageTypes,force:hasRecordId" access="global" controller = "CHCRM_KAPBgBusinessChanceController">
    <!--嘉实多业务总量 table columns -->
    <aura:attribute name="yearHeader" type="List"/>
    <aura:attribute name="caltrolAllColumns" type="List"/>
    <aura:attribute name="caltrolTableData" type="Object"/>
    <aura:attribute name="errors" type="Object" default="[]"/>    
    <aura:attribute name="draftValues" type="Object" default="[]"/>
    
    <aura:attribute name="editRow" type="Object" />
    <aura:attribute name="isEditForm" type="Boolean" default="false"/>
    
    <aura:attribute name="isPercent" type="Boolean" default="false"/> 
    
    <aura:attribute name="inputError" type="Boolean" default="false"/> 
    <aura:attribute name="errorMessage" type="List" default=""/>
    <aura:attribute name="isloading" type="boolean" default = "false"/>
    <aura:handler name="init" value="{! this }" action="{! c.init }"/>
    
    
    <aura:attribute name="isDraft" type="Boolean" default="false"/>
    <aura:handler event="force:refreshView" action="{!c.init}" />
    
    
    <lightning:card title="嘉实多业务总量" iconName="standard:lightning_usage"
                    class="slds-card slds-card_boundary headerBottomBorder forceRelatedListCardDesktop">
        
        <lightning:datatable columns="{! v.caltrolAllColumns }"
                             data="{! v.caltrolTableData }"
                             keyField="id"
                             hideCheckboxColumn = "true"
                             showRowNumberColumn = "false"
                             errors="{! v.errors }"
                             onrowaction="{! c.handleRowAction }"
                             />
        
    </lightning:card>
    <br/>
    <!--Modal Window-->
    <aura:if isTrue="{!v.isEditForm}"> 
        <section role="dialog" tabindex="-1" class="slds-modal slds-fade-in-open slds-modal_small" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1">
            <aura:if isTrue="{!v.isloading}"> 
                <div class="exampleHolder">
                    <lightning:spinner alternativeText="Loading" size="large" />
                </div>
            </aura:if>
            <div class="slds-modal__container">
                <header class="slds-modal__header">
                    <h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate">编辑 {! v.editRow.opTarget}</h2>
                </header>
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1" >
                    <aura:if isTrue="{!v.inputError}">
                        <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert">
                            <span class="slds-assistive-text">error</span>
                            <span class="slds-icon_container slds-icon-utility-error slds-m-right_x-small" title="Description of icon when needed">
                            </span>
                            <aura:iteration items="{!v.errorMessage}" var="item">
                                <h2>错误:  {!item}</h2><br/>
                            </aura:iteration>
                            <div class="slds-notify__close">
                                <button class="slds-button slds-button_icon slds-button_icon-small slds-button_icon-inverse" title="Close" onclick="{! c.cancelErrorAlert}">
                                    <!--<lightning:icon iconName="utility:close" title="Close" />-->
                                    x
                                </button>
                            </div>
                        </div>
                    </aura:if>
                    <!--<div class="slds-form-element__control">
                         <lightning:input label = "业务指标" type="text" disabled = "true" value="{! v.editRow.opTarget}"/>
                    </div>-->                                      
                    <aura:if isTrue="{!v.isPercent}">
                        <div class="slds-form-element__control">
                            <lightning:input   label = "{!v.yearHeader[0]+' (%)'}" step="1" max="100" type="number" disabled = "true" value="{! v.editRow.lastYear3}"/>
                        </div>
                        <div class="slds-form-element__control">
                            <lightning:input  label = "{!v.yearHeader[1]+' (%)'}"  step="1" max="100" type="number" disabled = "true" value="{! v.editRow.lastYear2}"/>
                        </div>
                        <div class="slds-form-element__control">
                            <lightning:input   label = "{!v.yearHeader[2]+' (%)'}"  step="1" max="100" type="number" disabled = "true" value="{! v.editRow.lastYear}"/>
                        </div>  
                        <div class="slds-form-element__control">
                            <lightning:input  label = "{!v.yearHeader[3]+' (%)'}"  step="1" max="100" type="number" value="{! v.editRow.curYear}"/>
                        </div>
                        <div class="slds-form-element__control">
                            <lightning:input  label = "{!v.yearHeader[4]+' (%)'}"  step="1" max="100" type="number" value="{! v.editRow.nextYear}"/>
                        </div>
                        <div class="slds-form-element__control">
                            <lightning:input  label = "{!v.yearHeader[5]+' (%)'}" step="1" max="100" type="number" value="{! v.editRow.nextYear2}"/>
                        </div>
                        <aura:set attribute="else">
                            <div class="slds-form-element__control">
                                <lightning:input   label = "{!v.yearHeader[0]}" type="number" disabled = "true" value="{! v.editRow.lastYear3}"/>
                            </div>
                            <div class="slds-form-element__control">
                                <lightning:input  label = "{!v.yearHeader[1]}" type="number" disabled = "true" value="{! v.editRow.lastYear2}"/>
                            </div>
                            <div class="slds-form-element__control">
                                <lightning:input   label = "{!v.yearHeader[2]}" type="number" disabled = "true" value="{! v.editRow.lastYear}"/>
                            </div>  
                            <div class="slds-form-element__control">
                                <lightning:input  label = "{!v.yearHeader[3]}" type="number" value="{! v.editRow.curYear}"/>
                            </div>
                            <div class="slds-form-element__control">
                                <lightning:input  label = "{!v.yearHeader[4]}" type="number" value="{! v.editRow.nextYear}"/>
                            </div>
                            <div class="slds-form-element__control">
                                <lightning:input  label = "{!v.yearHeader[5]}" type="number" value="{! v.editRow.nextYear2}"/>
                            </div>
                        </aura:set>
                    </aura:if>
                </div>
                <footer class="slds-modal__footer">
                    <button type="button" id="back" class="slds-button slds-button_neutral" onclick="{! c.closeEdit}">Cancel</button> 
                    <button class="slds-button slds-button_brand" onclick="{! c.editSave}">Save</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div> 
    </aura:if>
    
    
</aura:component>