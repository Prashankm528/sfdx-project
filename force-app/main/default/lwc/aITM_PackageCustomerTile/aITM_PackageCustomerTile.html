<template>
 
  <div class="spinner">
    <template if:true={isLoading}>
         <lightning-spinner alternative-text="Loading" variant="brand" size="large">
         </lightning-spinner>
    </template>
  </div>
  <c-a-i-t-m_-pricing-basis-modal onpricing={updatePricingBasis}></c-a-i-t-m_-pricing-basis-modal>
  <c-a-i-t-m_-modal-popup onpoint={updatePoint}></c-a-i-t-m_-modal-popup>
  <div class="slds-m-around-medium ">
  <template for:each={locationLineItems} for:item="keyValue" for:index="index"> 
    <lightning-layout vertical-align="center" key={keyValue.key} >
      <lightning-layout-item   size ="4">     
        <strong><lightning-input  type="checkbox" class="myCustomClass" label={keyValue.iATAWithlocationName} data-target-id={keyValue.locationId} data-value={keyValue.locationId} onchange={selectcheckbox} ></lightning-input></strong> 
      </lightning-layout-item>

      <lightning-layout-item size ="6">  
      </lightning-layout-item>
      <lightning-layout-item size ="2">
        <lightning-combobox
        style="width:170px; float:right;"
        onfocus={oldvalue}
        data-index={index}
        data-target-id={keyValue}
        data-value={keyValue.locationId}
        name={statusReadOnly}
        value={keyValue.locationStatus}
        options={options}
        onchange={handleChange} ></lightning-combobox>
      </lightning-layout-item>
    </lightning-layout>  
   

    <lightning-layout vertical-align="center" key={keyValue} >
      <lightning-layout-item   size ="9">
        <lightning-textarea class="slds-p-right_small" onfocus={oldvalue} value={keyValue.locationInternalNotes}  data-value={keyValue.locationId} onblur={handleInternalNotes} label="Internal Notes"  ></lightning-textarea>
      </lightning-layout-item>
    
    <lightning-layout-item size ="2" class="slds-p-top_small" >
        Location Contibution to Package USD
    </lightning-layout-item>
   <lightning-layout-item size="1"  >
        <lightning-input style="width:150px; float:right;"  onfocus={oldvalue}  value={keyValue.packageContribution} data-value={keyValue.locationId} onblur={getCurrencyValue} data-index={index} ></lightning-input>
      </lightning-layout-item>
     <!-- <lightning-layout-item size ="1" >
            <div class="slds-form-element">
              <div class="slds-form-element__control slds-has-divider--bottom">
                  <label class="slds-form-element__label">Currency</label> USD
                  <div  class="slds-grid_vertical-align-bottom">
                
                    
                    <div class="slds-form-element">
                        <lightning-formatted-text ></lightning-formatted-text>
                    </div>
                    
                  </div>
                </div>
            </div> 
          
      </lightning-layout-item> -->
      
    </lightning-layout>  <br  key={keyValue}/>

    <table  key={keyValue} class="slds-table slds-table--bordered slds-table--cell-buffer" role="grid">      
      <thead>  
          <tr class="slds-text-title--caps">
              <th>            
               <!-- <lightning-input data-target-id={keyValue.locationId} type="checkbox" onchange={selectcheckbox} ></lightning-input>
                <span class="slds-form-element__label"></span>   -->
              </th>
              <th scope="col">
                  <div class="slds-truncate" title="Customers">Customers</div>
              </th>
              <th scope="col" >
                  <div class="slds-truncate" title="Start Date">Start <br/> Date</div>
              </th>
              <th scope="col" >
                  <div class="slds-truncate" title="End Date">End <br/>Date</div>
              </th> 
              <th scope="col" >
                  <div class="slds-truncate" title="Pricing Basis">Pricing <br/> Basis</div>
              </th>
              <th scope="col" >
                <div class="slds-truncate" title="Requested Volume">Requested <br/> Volume</div>
              </th>
              <th scope="col" >
                <div class="slds-truncate" title="Offered Volume">Offered <br/> Volume</div>
              </th>
              <th scope="col" >
                <div class="slds-truncate" title="Percentage offered">Percentage  <br/> offered</div>
              </th>
              <th scope="col" >
                <div class="slds-truncate" title="Delivery Point">Delivery <br/> Point</div> 
              </th>
              <th scope="col" >
                <div class="slds-truncate" title="Diffrenential Offered">Diffrenential<br/> (Offered)</div>
              </th>
              <th scope="col" >
                <div class="slds-truncate" title="Diffrenential Package">Diffrenential  <br/> (Package)</div>
              </th>
              <th scope="col" >
                <div class="slds-truncate" title="Unit Of Measure">Unit Of <br/> Measure</div>
              </th>
              <th scope="col" >
                <div class="slds-truncate" title="Currency">Currency</div>
              </th>
           <!-- <th scope="col" >
              <div class="slds-truncate" title="Customer Cost Saving">Customer <br/> Cost <br/>Saving</div>
            </th> -->
            
         

          </tr>
      </thead>
      <tbody>        
          <template for:each={keyValue.locationLineItemsList} for:item="value"> 
              <tr key={value.Id}>
                  <th>    
                    <lightning-input type="checkbox" data-id={keyValue.locationId} data-record-id={keyValue.locationId} value={value.AITM_Tender_Location__r.Id}  data-target-id={value.Id} onchange={handleclickCheckBox} ></lightning-input>    
                  </th>
                  <td data-label="Customers">
                      <lightning-input class="customerValueCSS" onfocus={oldvalue} data-id={value.Id} data-record-id={value.AITM_Account__r.Id} value={value.AITM_Account__r.Name} onblur={handleAccountName} disabled></lightning-input> 
                      <!--<a href="#" class="customerValueCSS" data-id={value.AITM_Account__r.Id} onclick={openCustomerRecord}>{value.AITM_Account__r.Name}</a> -->
                  </td>
                  <td data-label="Start Date">
                    <lightning-input class="dateValueCSS" onfocus={oldvalue} data-id={value.Id} type="Date" value={value.AITM_Start_Date__c} format="dd-MMM-yy" onblur={handleStartDate}></lightning-input>
                  </td>
                  <td data-label="End Date">
                    <lightning-input class="dateValueCSS" onfocus={oldvalue} data-id={value.Id} type="Date" value={value.AITM_End_Date__c} format="dd-MMM-yy" onblur={handleEndDate}></lightning-input>
                  </td>
                  <td data-label="Pricing Basis">
                    <!--<lightning-input  onfocus={oldvalue} data-id={value.Id} value={value.AITM_DEPE_Pricing_Basis__c} onblur={handlePricing}></lightning-input> -->
                    <lightning-layout vertical-align="center">
                        <lightning-layout-item >
                          <lightning-input  onfocus={oldvalue} data-id={value.Id} data-basis={value.Id} value={value.AITM_Pricing_Basis__r.Name} onblur={handlePricing}></lightning-input>
                          </lightning-layout-item>
                          <lightning-layout-item  class="slds-p-top_medium">
                            <lightning-button-icon icon-name="utility:search" 
                            data-record-id={value.Id}                    
                            variant="bare"
                            onclick={editPricingBasis}
                          ></lightning-button-icon>
                          </lightning-layout-item>
                    </lightning-layout>
                  </td>
                 
                  <td data-label="Requested Volume">
                    <lightning-input class="customValueCSS"   onfocus={oldvalue}
                    data-id={value.Id} value={value.AITM_Requested_Volume_USG__c} onblur={handleVolume}></lightning-input>
                  </td>
                  <td data-label="Offered Volume">
                    <lightning-input  onfocus={oldvalue} data-id={value.Id} value={value.AITM_Offered_Volume__c} onblur={handleOffered}></lightning-input>
                  </td>
                  <td data-label="Percentage offered">
                    <lightning-input  onfocus={oldvalue} data-id={value.Id} value={value.AITM_Percentage_Volume_Offered__c} onblur={handlePercentage}></lightning-input>
                  </td>
                  <td data-label="Delivery Point">
                    <lightning-layout vertical-align="center">
                        <lightning-layout-item >
                            <lightning-input class="customValueCSS" onfocus={oldvalue} data-id={value.Id} data-name={value.Id}   id={value.Id} value={value.AITM_Location_Delivery_Point__r.AITM_Delivery_Point_External_Name__c} 
                          ></lightning-input>
                          </lightning-layout-item>
                          <lightning-layout-item  class="slds-p-top_medium">
                            <lightning-button-icon icon-name="utility:search"
                            data-record-id={value.Id}
                            data-value={value}
                            data-id={value.AITM_Tender_Location__r.AITM_Location__r.Id}
                            variant="bare"
                            alternative-text="Edit Record"
                            onclick={editRecord}></lightning-button-icon>
                          </lightning-layout-item>
                      </lightning-layout>
                  </td>
                  <td data-label="Diffrenential Offered">
                    <lightning-input  onfocus={oldvalue} data-id={value.Id} value={value.AITM_Offered_Differential__c} disabled></lightning-input>
                  </td>
                  <td data-label="Diffrenential Package">
                    <lightning-input  onfocus={oldvalue} data-id={value.Id} value={value.AITM_Package_Offered_Differential__c} onblur={handleDiffPackage}></lightning-input>
                  </td>
                  <td data-label="Unit Of Measure">
                    <lightning-combobox
                    

                    onfocus={oldvalue} data-id={value.Id}
                    value={value.AITM_Unit_Of_Measure__c}
                    options={uomOptions}
                    onchange={handleMeasure} ></lightning-combobox>
                    <!--<lightning-input  onfocus={oldvalue} data-id={value.Id} value={value.AITM_Unit_Of_Measure__c} onblur={handleMeasure}></lightning-input> -->
                  </td>
                  <td style="overflow: visible;
                  overflow-y: visible;" data-label="Currency">
                    <lightning-combobox
                    class ="currencyClass"

                    onfocus={oldvalue} data-id={value.Id}
                    value={value.AITM_Currency__c}
                    options={searchOptions}
                    onchange={handleCurrency} ></lightning-combobox>
                    <!-- <lightning-input class="customValueCSS" onfocus={oldvalue} data-id={value.Id} value={value.AITM_Currency__c} onblur={handleCurrency}></lightning-input> -->
                  </td>
                  
                
                <td  data-label="LOCATION NAME">
                  <a href="#" data-id={value.Id} onclick={openLineItemRecord}>more...</a>
                </td>
              
              </tr>
        </template>
      </tbody>
    </table><br key={keyValue.key} />
  </template>
  </div>
</template>